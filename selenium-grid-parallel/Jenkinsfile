import groovy.xml.XmlSlurper

pipeline {
    agent any

    environment {
        GRID_URL = "http://localhost:4444/wd/hub"
    }
    tools {
        maven 'Maven'
        jdk 'JAVA_HOME'
    }
    
    parameters {
        string(name: 'Branch_Name', defaultValue: 'master', description: 'Git Branch to be built')
        booleanParam(name: 'STOP_GRID_AFTER_RUN', defaultValue: false, description: 'Stop Selenium Grid after tests')
    }

    stages {
        
       
        
        stage('Log Stop Request') {
    		steps {
       			 echo "Checking if we need to stop Selenium Grid... STOP_GRID_AFTER_RUN - ${params.STOP_GRID_AFTER_RUN}"
   			 }
		}
		 stage('Parse TestNG Results') {
            steps {
                script {
                    def xmlPath = 'selenium-grid-parallel/target/surefire-reports/testng-results.xml'

 // Read XML file from workspace
                    def results = readXML file: 'selenium-grid-parallel/target/surefire-reports/testng-results.xml'

                    echo "Total Tests: ${results.'@total'}"
                    echo "Passed: ${results.'@passed'}"
                    echo "Failed: ${results.'@failed'}"
                   

                    def total   = results.@total.toInteger()
                    def passed  = results.@passed.toInteger()
                    def failed  = results.@failed.toInteger()
                    def skipped = results.@skipped.toInteger()

                    echo "Total:   ${total}"
                    echo "Passed:  ${passed}"
                    echo "Failed:  ${failed}"
                    echo "Skipped: ${skipped}"
                }
            }
        }

		
        
    }

   
    
     
}
